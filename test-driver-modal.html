<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Modal Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Driver Modal Functionality Test</h1>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>Manual Test</h2>
        <p>Open the admin dashboard and test the following:</p>
        <ol>
            <li>Click "Add Driver" button - modal should open</li>
            <li>Fill in driver details and submit - driver should be created</li>
            <li>Click "Edit" button on existing driver - modal should open with pre-filled data</li>
            <li>Click "Delete" button - confirmation dialog should appear</li>
        </ol>
        <a href="admin.html" target="_blank" style="padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">Open Admin Dashboard</a>
    </div>

    <script>
        // Test driver modal functionality
        function runTests() {
            const results = document.getElementById('testResults');
            let testsPassed = 0;
            let totalTests = 0;

            function addTestResult(testName, passed, message) {
                totalTests++;
                if (passed) testsPassed++;
                
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${passed ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <strong>${testName}:</strong> ${passed ? '‚úÖ PASSED' : '‚ùå FAILED'}<br>
                    ${message}
                `;
                results.appendChild(resultDiv);
            }

            // Test 1: Check if admin.html exists and is accessible
            fetch('admin.html')
                .then(response => {
                    addTestResult('Admin Dashboard Access', response.ok, 
                        response.ok ? 'Admin dashboard is accessible' : 'Admin dashboard not found');
                })
                .catch(error => {
                    addTestResult('Admin Dashboard Access', false, 'Error accessing admin dashboard: ' + error.message);
                });

            // Test 2: Check if driver API is working
            fetch('http://localhost:3001/api/drivers')
                .then(response => response.json())
                .then(data => {
                    addTestResult('Driver API Connection', true, 
                        `API is responding with ${Array.isArray(data.drivers) ? data.drivers.length : 0} drivers`);
                })
                .catch(error => {
                    addTestResult('Driver API Connection', false, 'Error connecting to driver API: ' + error.message);
                });

            // Test 3: Check if required elements exist in admin.html
            fetch('admin.html')
                .then(response => response.text())
                .then(html => {
                    const checks = [
                        { name: 'Driver Modal', pattern: /id="driverModal"/ },
                        { name: 'Driver Form', pattern: /id="driverForm"/ },
                        { name: 'Add Driver Button', pattern: /id="addDriverBtn"/ },
                        { name: 'Driver Modal Functions', pattern: /function openDriverModal/ },
                        { name: 'Driver Form Submission', pattern: /driverForm.*addEventListener/ }
                    ];

                    checks.forEach(check => {
                        const found = check.pattern.test(html);
                        addTestResult(check.name + ' Element', found, 
                            found ? `${check.name} found in admin.html` : `${check.name} missing from admin.html`);
                    });
                })
                .catch(error => {
                    addTestResult('HTML Structure Check', false, 'Error checking admin.html: ' + error.message);
                });

            // Show final results
            setTimeout(() => {
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'test-result ' + (testsPassed === totalTests ? 'success' : 'error');
                summaryDiv.innerHTML = `
                    <strong>Test Summary:</strong> ${testsPassed}/${totalTests} tests passed
                    ${testsPassed === totalTests ? '<br>üéâ All tests passed! Driver functionality should be working.' : '<br>‚ö†Ô∏è Some tests failed. Please check the issues above.'}
                `;
                results.appendChild(summaryDiv);
            }, 2000);
        }

        // Run tests when page loads
        window.addEventListener('load', runTests);
    </script>
</body>
</html>